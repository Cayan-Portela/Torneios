
/***********************************************************************************
************************************************************************************	


	get first type of macro variables
		and output data sets


************************************************************************************
************************************************************************************
*/

%let wrds=wrds.wharton.upenn.edu 4016;options comamid=TCP remote=WRDS;
	signon username=_prompt_; 
rsubmit;
data crspr;
	set frb.rates_monthly;
	crspread=(baa_na-aaa_na)/100;
	term=(TCMNOM_Y10-TCMNOM_Y1)/100;
	keep date crspread term ;
	run;
proc sql;
	create table factors
	as select a.*,b.mktrf,b.smb,b.hml,b.rf,b.umd
	from crspr a left join ff.factors_monthly b
	on year(a.date)=year(b.date) and month(a.date)=month(b.date);
	quit;
proc sql;
	create table factors
	as select a.*,b.ps_level,b.ps_innov
	from factors a left join ff.liq_ps b
	on year(a.date)=year(b.date) and month(a.date)=month(b.date);
	quit;
data wt;
	set pwt.pwt71;
	where isocode='USA';
	date=mdy(12,31,year);
	keep date cgdp;
	run;
data na;
	set pwt.na70;
	where isocode='USA';
	cons=cacur/pop;
	date=mdy(12,31,year);
	keep date cons;
	run;

data cboe;
	set cboe.cboe;
	keep	vix vxn vxd vxo date; *daily, begins in 1986;
	run;
*create all other factors;
proc sql;
	create table cboe2
	as select intnx('MONTH',date,0,'end') as date,mean(vxo) as vix
	from cboe
	group by intnx('MONTH',date,0,'end');
	quit;
proc sort data=cboe2 nodupkey;
	by date;
	run;
data mct;
	set crsp.mcti;
	bond=b20ret;
	date=caldt;
	keep date cpiret bond;
	run;
data reit;
	set crsp.crsp_ziman_monthly_index;
	where indno=1000800;*begins 1980;
	reit=tret;
	date=caldt;
	keep date reit;
	run;

proc sql;
	create table factors
	as select a.*,b.cgdp,b.date as mdate
	from factors a left join wt b
	on intnx('MONTH',a.date,-13)<=b.date<=a.date;
	quit;
proc sort data=factors;
	by date descending mdate;
	run;
proc sort data=factors(drop=mdate) nodupkey;
	by date;
	run;
proc sql;
	create table factors
	as select a.*,b.cons,b.date as mdate
	from factors a left join na b
	on intnx('MONTH',a.date,-13)<=b.date<=a.date;
	quit;
proc sort data=factors;
	by date descending mdate;
	run;
proc sort data=factors(drop=mdate) nodupkey;
	by date;
	run;

proc sql;
	create table factors
	as select a.*,b.vix
	from factors a left join cboe2 b
	on year(a.date)=year(b.date) and month(a.date)=month(b.date);
	quit;
proc sql;
	create table factors
	as select a.*,b.cpiret,b.bond
	from factors a left join mct b
	on year(a.date)=year(b.date) and month(a.date)=month(b.date);
	quit;
proc sql;
	create table factors
	as select a.*,b.reit
	from factors a left join reit b
	on year(a.date)=year(b.date) and month(a.date)=month(b.date);
	quit;
*generate some others;

data msf;
	set crsp.msf;
	where date>='01JAN1975'd;
	mktcap=abs(prc)*shrout;
	keep permno date mktcap;
	run;		
proc sql;
	create table data
	as select substr(compress(cusip),1,6) as cnum,c.gvkey,fyearq,fqtr,datadate,rdq,
		niq,ceqq,atq,saleq,abs(prccq)*cshoq as mveq,dvy

		from comp.company as c, comp.fundq as f
	  where f.gvkey = c.gvkey
	  and f.indfmt='INDL' and f.datafmt='STD' and f.popsrc='D' and f.consol='C'
		and not missing(niq) and datadate>='01JAN1970'd;
	quit;  	
proc sort data=data nodupkey;
	by gvkey datadate;
	run;
data data;
	set data;
	by gvkey datadate;
	retain count;
	sgr=(saleq-lag4(saleq))/lag4(saleq);
	agr=(atq-lag(atq))/lag(atq);
	bm=ceqq/mveq;
	ep=niq/mveq;
	dy=dvy/mveq;
	if first.gvkey then count=1;
		else count+1;
	if count<4 then delete;
	if abs(sgr)>10 then delete;
	if abs(agr)>10 then delete;
	if abs(bm)>20 then delete;
	if abs(ep)>1 then delete;
	if dy>1 then delete;
	run;					
proc sort data=crsp.ccmxpf_linktable out=lnk;
  					where LINKTYPE in ("LU", "LC", "LD", "LF", "LN", "LO", "LS", "LX") and
       					(2015 >= year(LINKDT) or LINKDT = .B) and (1950 <= year(LINKENDDT) or LINKENDDT = .E);
  					by GVKEY LINKDT; run;	   		
					proc sql; create table temp as select a.lpermno as permno,b.*
						from lnk a,data b where a.gvkey=b.gvkey 
						and (LINKDT <= b.datadate or LINKDT = .B) and (b.datadate <= LINKENDDT or LINKENDDT = .E) and lpermno ne . and not missing(b.gvkey);
					quit;  
					data temp;
						set temp;
						where not missing(permno) and not missing(rdq);
					run;  
proc sql;
	create table temp2
	as select *
	from msf a left join temp b
	on a.permno=b.permno and intnx('MONTH',a.date,-4)<=b.rdq<a.date;
	quit;
proc sort data=temp2;
	by permno date descending rdq;
	run;
proc sort data=temp2 nodupkey;
	by permno date;
	run;
proc sql;
	create table temp2
	as select *,mktcap/sum(mktcap) as wt
	from temp2 
	group by date;
	quit;
proc sql;
	create table temp3
	as select distinct date,sum(sgr*wt) as sgr_mkt,
	sum(agr*wt) as agr_mkt,
	sum(bm*wt) as bm_mkt,
	sum(ep*wt) as ep_mkt,
	sum(dy*wt) as dy_mkt,
	mean(date-rdq) as avglag
	from temp2
	group by date;
	quit;
proc sort data=temp3 nodupkey;
	by date;
	run;			
data factors2;
	set factors;
	keep date crspread term rf mktrf smb hml umd ps_level ps_innov cpiret bond reit cgdp cons vix;
	run;	
proc sql;
	create table factors
	as select a.*,b.sgr_mkt,b.agr_mkt,b.bm_mkt,b.ep_mkt,b.dy_mkt,b.avglag,b.avglag*b.avglag as avglagsq
	from factors2 a left join temp3 b
	on year(a.date)=year(b.date) and month(a.date)=month(b.date);
	quit;
proc download data=factors out=factorswrds;
	run;
endrsubmit; 

data factorswrds;
	set factorswrds;
	where date>='01JAN1970'd;
	run;
 
data bwsent; *from jeffrey wurgler's website:  http://people.stern.nyu.edu/jwurgler/;
   *infile datalines; 
   input yrmo $6. sent 8.3 sent2 8.3;
   datalines; 
196507	-1.816	-1.578
196508	-1.915	-1.605
196509	-1.846	-1.553
196510	-1.734	-1.449
196511	-1.558	-1.492
196512	-1.636	-1.531
196601	-1.596	-1.569
196602	-1.681	-1.648
196603	-1.357	-1.453
196604	-1.428	-1.486
196605	-1.484	-1.443
196606	-1.286	-1.376
196607	-1.226	-1.301
196608	-1.120	-1.169
196609	-1.261	-1.243
196610	-1.318	-1.217
196611	-1.272	-1.168
196612	-1.193	-1.029
196701	-1.049	-0.914
196702	-0.852	-0.830
196703	-0.842	-0.872
196704	-0.862	-0.745
196705	-0.772	-0.743
196706	-0.773	-0.661
196707	-0.776	-0.604
196708	-0.697	-0.546
196709	-0.466	-0.437
196710	-0.655	-0.528
196711	-0.424	-0.244
196712	-0.191	-0.004
196801	-0.057	0.147
196802	0.013	0.306
196803	0.001	0.294
196804	-0.043	0.188
196805	0.055	0.409
196806	0.258	0.587
196807	0.499	0.762
196808	0.776	0.897
196809	0.808	1.043
196810	1.274	1.365
196811	1.461	1.454
196812	1.968	2.004
196901	1.891	1.893
196902	1.805	1.793
196903	1.782	1.773
196904	2.069	2.039
196905	2.531	2.295
196906	2.465	2.329
196907	2.450	2.304
196908	2.328	2.210
196909	2.544	2.422
196910	2.456	2.288
196911	2.523	2.315
196912	2.691	2.400
197001	2.398	2.214
197002	2.083	1.949
197003	2.148	1.932
197004	1.944	1.802
197005	1.610	1.592
197006	1.343	1.243
197007	1.271	1.170
197008	1.058	1.009
197009	1.109	0.943
197010	0.944	0.745
197011	0.695	0.557
197012	0.791	0.447
197101	0.616	0.296
197102	0.395	0.083
197103	0.104	-0.074
197104	-0.112	-0.393
197105	-0.342	-0.601
197106	-0.427	-0.697
197107	-0.402	-0.672
197108	-0.463	-0.778
197109	-0.488	-0.667
197110	-0.792	-0.777
197111	-0.940	-0.927
197112	-1.210	-0.929
197201	-1.108	-0.795
197202	-1.067	-0.828
197203	-0.863	-0.696
197204	-0.847	-0.633
197205	-0.745	-0.635
197206	-0.679	-0.566
197207	-0.723	-0.608
197208	-0.727	-0.516
197209	-0.544	-0.483
197210	-0.480	-0.538
197211	-0.534	-0.490
197212	-0.476	-0.373
197301	-0.192	-0.392
197302	-0.058	-0.265
197303	-0.017	-0.245
197304	-0.015	-0.333
197305	-0.284	-0.515
197306	-0.373	-0.651
197307	-0.411	-0.749
197308	-0.500	-0.877
197309	-0.596	-0.947
197310	-0.738	-1.073
197311	-0.760	-1.247
197312	-0.826	-1.129
197401	-0.838	-1.132
197402	-1.020	-1.377
197403	-1.150	-1.453
197404	-1.451	-1.717
197405	-1.564	-1.827
197406	-1.650	-1.875
197407	-1.677	-1.896
197408	-1.866	-2.131
197409	-1.737	-1.976
197410	-2.018	-2.265
197411	-2.235	-2.514
197412	-1.658	-2.280
197501	-1.547	-2.136
197502	-1.859	-2.382
197503	-1.925	-2.498
197504	-1.790	-2.523
197505	-1.600	-2.533
197506	-1.689	-2.548
197507	-1.621	-2.396
197508	-1.634	-2.365
197509	-1.721	-2.347
197510	-1.659	-2.205
197511	-1.938	-2.284
197512	-2.237	-2.337
197601	-2.110	-2.134
197602	-2.381	-2.142
197603	-2.307	-2.026
197604	-2.464	-1.928
197605	-2.578	-1.850
197606	-2.326	-1.747
197607	-2.208	-1.618
197608	-2.224	-1.680
197609	-2.168	-1.697
197610	-2.113	-1.709
197611	-2.213	-1.757
197612	-1.986	-1.655
197701	-1.756	-1.508
197702	-1.511	-1.399
197703	-1.552	-1.328
197704	-1.526	-1.328
197705	-1.674	-1.517
197706	-1.816	-1.516
197707	-1.740	-1.503
197708	-1.795	-1.522
197709	-1.829	-1.525
197710	-1.741	-1.509
197711	-1.493	-1.465
197712	-1.440	-1.405
197801	-1.544	-1.485
197802	-1.479	-1.517
197803	-1.349	-1.462
197804	-1.232	-1.237
197805	-1.205	-1.256
197806	-1.168	-1.274
197807	-1.273	-1.333
197808	-1.227	-1.281
197809	-1.029	-1.200
197810	-1.154	-1.173
197811	-1.174	-1.124
197812	-1.060	-1.084
197901	-0.966	-0.960
197902	-1.054	-1.004
197903	-0.980	-1.022
197904	-0.818	-0.952
197905	-0.725	-0.867
197906	-0.360	-0.635
197907	-0.240	-0.505
197908	0.055	-0.363
197909	0.142	-0.282
197910	0.025	-0.445
197911	0.108	-0.402
197912	0.167	-0.346
198001	0.193	-0.349
198002	0.049	-0.308
198003	0.233	-0.137
198004	0.204	-0.213
198005	0.476	0.006
198006	0.415	0.068
198007	0.477	0.116
198008	0.614	0.051
198009	0.430	0.015
198010	0.480	0.044
198011	0.507	0.223
198012	0.852	0.540
198101	1.138	0.685
198102	1.699	0.914
198103	1.705	1.005
198104	1.634	0.941
198105	1.360	0.878
198106	1.455	0.989
198107	1.313	0.888
198108	0.851	1.065
198109	1.166	1.217
198110	1.324	1.277
198111	1.566	1.398
198112	1.773	1.565
198201	1.531	1.410
198202	1.440	1.460
198203	1.542	1.574
198204	1.497	1.538
198205	1.652	1.597
198206	1.637	1.526
198207	1.678	1.385
198208	1.744	1.190
198209	1.506	1.045
198210	1.411	0.966
198211	1.279	0.960
198212	1.488	0.943
198301	1.114	0.804
198302	1.160	0.701
198303	1.040	0.539
198304	0.981	0.588
198305	0.880	0.516
198306	0.923	0.540
198307	0.905	0.656
198308	0.884	0.665
198309	0.946	0.774
198310	1.276	1.234
198311	1.558	1.471
198312	1.310	1.642
198401	1.817	1.975
198402	1.756	2.090
198403	1.750	2.071
198404	1.666	1.879
198405	1.936	2.129
198406	1.971	2.179
198407	1.817	2.110
198408	1.658	1.843
198409	1.728	1.812
198410	1.434	1.505
198411	1.424	1.487
198412	1.231	1.343
198501	1.185	1.245
198502	1.216	1.151
198503	1.063	1.078
198504	1.088	1.045
198505	0.934	0.949
198506	0.757	0.831
198507	0.777	0.751
198508	0.797	0.845
198509	0.654	0.818
198510	0.662	0.731
198511	0.614	0.661
198512	0.682	0.724
198601	0.661	0.812
198602	0.526	0.705
198603	0.545	0.671
198604	0.248	0.607
198605	0.297	0.612
198606	0.298	0.561
198607	0.347	0.721
198608	0.309	0.700
198609	0.297	0.713
198610	0.337	0.721
198611	0.407	0.824
198612	0.442	0.841
198701	0.564	0.809
198702	0.486	0.727
198703	0.415	0.708
198704	0.549	0.755
198705	0.502	0.695
198706	0.394	0.653
198707	0.341	0.547
198708	0.272	0.488
198709	0.349	0.560
198710	0.195	0.498
198711	0.243	0.554
198712	0.057	0.369
198801	0.003	0.415
198802	0.053	0.462
198803	0.080	0.381
198804	0.008	0.281
198805	0.031	0.278
198806	-0.019	0.223
198807	-0.011	0.161
198808	0.052	0.159
198809	0.078	0.083
198810	0.018	0.002
198811	0.051	-0.002
198812	0.063	0.031
198901	0.011	-0.060
198902	-0.052	-0.114
198903	-0.156	-0.144
198904	-0.086	-0.176
198905	-0.129	-0.254
198906	-0.053	-0.165
198907	-0.168	-0.272
198908	-0.320	-0.356
198909	-0.347	-0.376
198910	-0.462	-0.476
198911	-0.461	-0.475
198912	-0.298	-0.392
199001	-0.323	-0.380
199002	-0.310	-0.380
199003	-0.284	-0.363
199004	-0.261	-0.222
199005	-0.382	-0.264
199006	-0.347	-0.273
199007	-0.475	-0.335
199008	-0.529	-0.229
199009	-0.542	-0.221
199010	-0.529	-0.232
199011	-0.548	-0.323
199012	-0.591	-0.352
199101	-0.695	-0.393
199102	-0.652	-0.361
199103	-0.690	-0.413
199104	-0.417	-0.431
199105	-0.326	-0.361
199106	-0.381	-0.334
199107	-0.463	-0.456
199108	-0.228	-0.537
199109	-0.298	-0.535
199110	-0.343	-0.563
199111	-0.287	-0.425
199112	-0.255	-0.365
199201	-0.054	-0.293
199202	0.000	-0.150
199203	0.012	-0.035
199204	-0.294	-0.076
199205	-0.276	-0.097
199206	-0.209	-0.110
199207	-0.247	-0.128
199208	-0.183	-0.081
199209	-0.074	-0.033
199210	-0.105	-0.057
199211	-0.096	0.005
199212	0.008	0.096
199301	-0.064	0.189
199302	0.084	0.236
199303	0.091	0.159
199304	-0.189	-0.097
199305	-0.265	-0.191
199306	-0.366	-0.216
199307	-0.277	-0.180
199308	-0.419	-0.250
199309	-0.391	-0.206
199310	-0.262	-0.076
199311	-0.119	0.009
199312	-0.120	0.029
199401	-0.067	0.036
199402	-0.135	-0.030
199403	-0.151	-0.038
199404	-0.224	-0.069
199405	-0.209	0.045
199406	-0.060	0.148
199407	-0.098	0.129
199408	0.010	0.195
199409	0.050	0.241
199410	-0.009	0.196
199411	-0.024	0.236
199412	-0.056	0.183
199501	0.028	0.244
199502	-0.052	0.264
199503	-0.093	0.193
199504	-0.189	0.045
199505	-0.213	-0.049
199506	-0.226	-0.072
199507	-0.282	-0.134
199508	-0.299	-0.042
199509	-0.211	0.007
199510	-0.179	0.022
199511	-0.084	0.064
199512	-0.013	0.083
199601	0.033	0.102
199602	0.023	0.086
199603	0.092	0.114
199604	0.006	0.015
199605	0.013	0.056
199606	0.182	0.233
199607	0.269	0.335
199608	0.444	0.436
199609	0.417	0.431
199610	0.447	0.405
199611	0.412	0.403
199612	0.452	0.472
199701	0.383	0.479
199702	0.544	0.552
199703	0.445	0.552
199704	0.570	0.715
199705	0.484	0.656
199706	0.461	0.587
199707	0.275	0.427
199708	0.324	0.514
199709	0.400	0.594
199710	0.181	0.460
199711	0.232	0.488
199712	0.204	0.517
199801	0.204	0.508
199802	0.056	0.369
199803	0.034	0.309
199804	-0.206	0.067
199805	-0.103	0.155
199806	-0.081	0.130
199807	0.104	0.255
199808	0.154	0.346
199809	0.159	0.334
199810	0.146	0.312
199811	0.068	0.183
199812	-0.040	0.041
199901	0.044	0.041
199902	0.096	0.135
199903	0.055	0.115
199904	0.071	0.046
199905	0.016	-0.007
199906	-0.022	0.072
199907	-0.153	0.015
199908	-0.115	-0.120
199909	0.077	0.040
199910	-0.013	-0.053
199911	0.041	0.049
199912	0.383	0.250
200001	0.413	0.536
200002	0.467	0.498
200003	0.903	0.765
200004	0.526	0.435
200005	0.800	0.674
200006	0.992	0.823
200007	1.250	1.016
200008	1.145	0.968
200009	1.170	1.014
200010	1.254	1.040
200011	1.607	1.407
200012	1.788	1.629
200101	2.063	1.806
200102	2.497	2.320
200103	2.229	2.210
200104	1.784	1.937
200105	1.720	1.805
200106	1.985	2.117
200107	1.880	2.017
200108	1.831	2.041
200109	1.742	1.922
200110	1.425	1.744
200111	0.876	1.206
200112	0.848	1.023
200201	1.043	1.206
200202	0.504	0.686
200203	0.218	0.416
200204	0.541	0.485
200205	0.412	0.460
200206	0.404	0.466
200207	0.001	0.112
200208	-0.125	0.005
200209	-0.514	-0.373
200210	-0.334	-0.271
200211	-0.184	-0.138
200212	-0.583	-0.236
200301	-0.492	-0.276
200302	-0.541	-0.407
200303	-0.421	-0.346
200304	-0.780	-0.616
200305	-0.902	-0.692
200306	-0.757	-0.686
200307	-0.831	-0.778
200308	-0.706	-0.807
200309	-0.589	-0.676
200310	-0.576	-0.602
200311	-0.457	-0.505
200312	-0.563	-0.594
200401	-0.396	-0.463
200402	-0.356	-0.351
200403	-0.296	-0.378
200404	-0.265	-0.275
200405	-0.155	-0.253
200406	-0.134	-0.188
200407	0.021	-0.011
200408	0.031	0.079
200409	0.009	0.042
200410	0.099	0.026
200411	0.081	-0.006
200412	0.015	-0.022
200501	-0.019	0.050
200502	-0.007	0.016
200503	-0.223	-0.015
200504	0.012	0.029
200505	-0.039	0.023
200506	-0.208	-0.018
200507	-0.279	-0.181
200508	-0.125	-0.165
200509	0.089	-0.130
200510	0.104	-0.106
200511	-0.095	-0.055
200512	-0.023	0.009
200601	0.004	-0.051
200602	-0.067	-0.118
200603	-0.080	-0.119
200604	-0.104	-0.147
200605	0.045	-0.047
200606	0.096	0.008
200607	0.148	0.078
200608	0.074	0.093
200609	-0.222	0.127
200610	-0.245	0.142
200611	-0.009	0.208
200612	0.107	0.204
200701	0.077	0.277
200702	0.163	0.439
200703	0.331	0.491
200704	0.320	0.538
200705	0.172	0.370
200706	0.278	0.415
200707	0.229	0.357
200708	0.069	0.313
200709	0.133	0.279
200710	0.171	0.281
200711	0.275	0.278
200712	0.035	0.267
200801	0.117	0.364
200802	0.209	0.403
200803	0.259	0.369
200804	0.249	0.284
200805	0.229	0.220
200806	0.340	0.210
200807	0.363	0.199
200808	0.450	0.257
200809	0.422	0.064
200810	0.259	0.063
200811	-0.333	-0.259
200812	-0.213	-0.266
200901	-0.128	-0.306
200902	-0.235	-0.483
200903	-0.330	-0.492
200904	-0.490	-0.617
200905	-0.397	-0.573
200906	-0.350	-0.552
200907	-0.054	-0.407
200908	-0.142	-0.483
200909	-0.337	-0.454
200910	-0.239	-0.513
200911	-0.136	-0.567
200912	-0.017	-0.510
201001	-0.153	-0.525
201002	-0.078	-0.432
201003	-0.136	-0.418
201004	-0.007	-0.228
201005	-0.137	-0.153
201006	-0.046	0.051
201007	-0.297	0.048
201008	-0.077	0.113
201009	-0.011	0.045
201010	-0.157	-0.129
201011	-0.123	-0.211
201012	-0.118	-0.255
;
run;


data csent; *from michigan consumer sentiment index: http://www.sca.isr.umich.edu/data-archive/mine.php;
   infile datalines; 
   input month 2.0 year 8.0 csent 8.1;
   datalines; 
1	1978	83.7
2	1978	84.3
3	1978	78.8
4	1978	81.6
5	1978	82.9
6	1978	80
7	1978	82.4
8	1978	78.4
9	1978	80.4
10	1978	79.3
11	1978	75
12	1978	66.1
1	1979	72.1
2	1979	73.9
3	1979	68.4
4	1979	66
5	1979	68.1
6	1979	65.8
7	1979	60.4
8	1979	64.5
9	1979	66.7
10	1979	62.1
11	1979	63.3
12	1979	61
1	1980	67
2	1980	66.9
3	1980	56.5
4	1980	52.7
5	1980	51.7
6	1980	58.7
7	1980	62.3
8	1980	67.3
9	1980	73.7
10	1980	75
11	1980	76.7
12	1980	64.5
1	1981	71.4
2	1981	66.9
3	1981	66.5
4	1981	72.4
5	1981	76.3
6	1981	73.1
7	1981	74.1
8	1981	77.2
9	1981	73.1
10	1981	70.3
11	1981	62.5
12	1981	64.3
1	1982	71
2	1982	66.5
3	1982	62
4	1982	65.5
5	1982	67.5
6	1982	65.7
7	1982	65.4
8	1982	65.4
9	1982	69.3
10	1982	73.4
11	1982	72.1
12	1982	71.9
1	1983	70.4
2	1983	74.6
3	1983	80.8
4	1983	89.1
5	1983	93.3
6	1983	92.2
7	1983	92.8
8	1983	90.9
9	1983	89.9
10	1983	89.3
11	1983	91.1
12	1983	94.2
1	1984	100.1
2	1984	97.4
3	1984	101
4	1984	96.1
5	1984	98.1
6	1984	95.5
7	1984	96.6
8	1984	99.1
9	1984	100.9
10	1984	96.3
11	1984	95.7
12	1984	92.9
1	1985	96
2	1985	93.7
3	1985	93.7
4	1985	94.6
5	1985	91.8
6	1985	96.5
7	1985	94
8	1985	92.4
9	1985	92.1
10	1985	88.4
11	1985	90.9
12	1985	93.9
1	1986	95.6
2	1986	95.9
3	1986	95.1
4	1986	96.2
5	1986	94.8
6	1986	99.3
7	1986	97.7
8	1986	94.9
9	1986	91.9
10	1986	95.6
11	1986	91.4
12	1986	89.1
1	1987	90.4
2	1987	90.2
3	1987	90.8
4	1987	92.8
5	1987	91.1
6	1987	91.5
7	1987	93.7
8	1987	94.4
9	1987	93.6
10	1987	89.3
11	1987	83.1
12	1987	86.8
1	1988	90.8
2	1988	91.6
3	1988	94.6
4	1988	91.2
5	1988	94.8
6	1988	94.7
7	1988	93.4
8	1988	97.4
9	1988	97.3
10	1988	94.1
11	1988	93
12	1988	91.9
1	1989	97.9
2	1989	95.4
3	1989	94.3
4	1989	91.5
5	1989	90.7
6	1989	90.6
7	1989	92
8	1989	89.6
9	1989	95.8
10	1989	93.9
11	1989	90.9
12	1989	90.5
1	1990	93
2	1990	89.5
3	1990	91.3
4	1990	93.9
5	1990	90.6
6	1990	88.3
7	1990	88.2
8	1990	76.4
9	1990	72.8
10	1990	63.9
11	1990	66
12	1990	65.5
1	1991	66.8
2	1991	70.4
3	1991	87.7
4	1991	81.8
5	1991	78.3
6	1991	82.1
7	1991	82.9
8	1991	82
9	1991	83
10	1991	78.3
11	1991	69.1
12	1991	68.2
1	1992	67.5
2	1992	68.8
3	1992	76
4	1992	77.2
5	1992	79.2
6	1992	80.4
7	1992	76.6
8	1992	76.1
9	1992	75.6
10	1992	73.3
11	1992	85.3
12	1992	91
1	1993	89.3
2	1993	86.6
3	1993	85.9
4	1993	85.6
5	1993	80.3
6	1993	81.5
7	1993	77
8	1993	77.3
9	1993	77.9
10	1993	82.7
11	1993	81.2
12	1993	88.2
1	1994	94.3
2	1994	93.2
3	1994	91.5
4	1994	92.6
5	1994	92.8
6	1994	91.2
7	1994	89
8	1994	91.7
9	1994	91.5
10	1994	92.7
11	1994	91.6
12	1994	95.1
1	1995	97.6
2	1995	95.1
3	1995	90.3
4	1995	92.5
5	1995	89.8
6	1995	92.7
7	1995	94.4
8	1995	96.2
9	1995	88.9
10	1995	90.2
11	1995	88.2
12	1995	91
1	1996	89.3
2	1996	88.5
3	1996	93.7
4	1996	92.7
5	1996	89.4
6	1996	92.4
7	1996	94.7
8	1996	95.3
9	1996	94.7
10	1996	96.5
11	1996	99.2
12	1996	96.9
1	1997	97.4
2	1997	99.7
3	1997	100
4	1997	101.4
5	1997	103.2
6	1997	104.5
7	1997	107.1
8	1997	104.4
9	1997	106
10	1997	105.6
11	1997	107.2
12	1997	102.1
1	1998	106.6
2	1998	110.4
3	1998	106.5
4	1998	108.7
5	1998	106.5
6	1998	105.6
7	1998	105.2
8	1998	104.4
9	1998	100.9
10	1998	97.4
11	1998	102.7
12	1998	100.5
1	1999	103.9
2	1999	108.1
3	1999	105.7
4	1999	104.6
5	1999	106.8
6	1999	107.3
7	1999	106
8	1999	104.5
9	1999	107.2
10	1999	103.2
11	1999	107.2
12	1999	105.4
1	2000	112
2	2000	111.3
3	2000	107.1
4	2000	109.2
5	2000	110.7
6	2000	106.4
7	2000	108.3
8	2000	107.3
9	2000	106.8
10	2000	105.8
11	2000	107.6
12	2000	98.4
1	2001	94.7
2	2001	90.6
3	2001	91.5
4	2001	88.4
5	2001	92
6	2001	92.6
7	2001	92.4
8	2001	91.5
9	2001	81.8
10	2001	82.7
11	2001	83.9
12	2001	88.8
1	2002	93
2	2002	90.7
3	2002	95.7
4	2002	93
5	2002	96.9
6	2002	92.4
7	2002	88.1
8	2002	87.6
9	2002	86.1
10	2002	80.6
11	2002	84.2
12	2002	86.7
1	2003	82.4
2	2003	79.9
3	2003	77.6
4	2003	86
5	2003	92.1
6	2003	89.7
7	2003	90.9
8	2003	89.3
9	2003	87.7
10	2003	89.6
11	2003	93.7
12	2003	92.6
1	2004	103.8
2	2004	94.4
3	2004	95.8
4	2004	94.2
5	2004	90.2
6	2004	95.6
7	2004	96.7
8	2004	95.9
9	2004	94.2
10	2004	91.7
11	2004	92.8
12	2004	97.1
1	2005	95.5
2	2005	94.1
3	2005	92.6
4	2005	87.7
5	2005	86.9
6	2005	96
7	2005	96.5
8	2005	89.1
9	2005	76.9
10	2005	74.2
11	2005	81.6
12	2005	91.5
1	2006	91.2
2	2006	86.7
3	2006	88.9
4	2006	87.4
5	2006	79.1
6	2006	84.9
7	2006	84.7
8	2006	82
9	2006	85.4
10	2006	93.6
11	2006	92.1
12	2006	91.7
1	2007	96.9
2	2007	91.3
3	2007	88.4
4	2007	87.1
5	2007	88.3
6	2007	85.3
7	2007	90.4
8	2007	83.4
9	2007	83.4
10	2007	80.9
11	2007	76.1
12	2007	75.5
1	2008	78.4
2	2008	70.8
3	2008	69.5
4	2008	62.6
5	2008	59.8
6	2008	56.4
7	2008	61.2
8	2008	63
9	2008	70.3
10	2008	57.6
11	2008	55.3
12	2008	60.1
1	2009	61.2
2	2009	56.3
3	2009	57.3
4	2009	65.1
5	2009	68.7
6	2009	70.8
7	2009	66
8	2009	65.7
9	2009	73.5
10	2009	70.6
11	2009	67.4
12	2009	72.5
1	2010	74.4
2	2010	73.6
3	2010	73.6
4	2010	72.2
5	2010	73.6
6	2010	76
7	2010	67.8
8	2010	68.9
9	2010	68.2
10	2010	67.7
11	2010	71.6
12	2010	74.5
1	2011	74.2
2	2011	77.5
3	2011	67.5
4	2011	69.8
5	2011	74.3
6	2011	71.5
7	2011	63.7
8	2011	55.8
9	2011	59.5
10	2011	60.8
11	2011	63.7
12	2011	69.9
1	2012	75
2	2012	75.3
3	2012	76.2
4	2012	76.4
5	2012	79.3
6	2012	73.2
7	2012	72.3
8	2012	74.3
9	2012	78.3
10	2012	82.6
11	2012	82.7
12	2012	72.9
1	2013	73.8
2	2013	77.6
3	2013	78.6
4	2013	76.4
5	2013	84.5
6	2013	84.1
7	2013	85.1
;
run;

data bwsent;
	set bwsent;
	yr=1*substr(yrmo,1,4);
	mo=1*substr(yrmo,5,2);
	run;
proc sql;
	create table factors
	as select a.*,b.sent,b.sent2
	from factorswrds a left join bwsent b
	on year(a.date)=b.yr and month(a.date)=b.mo;
	quit;
proc sql;
	create table factors
	as select a.*,b.csent
	from factors a left join csent b
	on year(a.date)=b.year and month(a.date)=b.month;
	quit;
data factors;
	set factors;
	if month(date)=1 then jan=1;
		else jan=0;
	run;

*Novy-Marx variables;
*democratic president;
data factors;
	set factors;
	if year(date) in (1961,1962,1963,1964,1965,1966,1967,1968,1977,1978,1979,1980,1993,1994,1995,1996,1997,1998,1999,2000,2009,2010,2011,2013,2013) then demo=1;
		else demo=0;
	run;


*max monthly temperature;
data temphi; *from www.ncdc.noaa.gov/cdo-web/search;
   *infile datalines; 
   input yrmoday $8. temphi 8.0;
   datalines;
19700101	106
19700201	139
19700301	133
19700401	278
19700501	339
19700601	328
19700701	344
19700801	344
19700901	344
19701001	267
19701101	194
19701201	189
19710101	78
19710201	189
19710301	206
19710401	244
19710501	294
19710601	339
19710701	356
19710801	333
19710901	328
19711001	256
19711101	239
19711201	172
19720101	167
19720201	167
19720301	228
19720401	300
19720501	300
19720601	300
19720701	344
19720801	344
19720901	333
19721001	233
19721101	200
19721201	161
19730101	189
19730201	144
19730301	189
19730401	300
19730501	278
19730601	350
19730701	344
19730801	367
19730901	356
19731001	278
19731101	250
19731201	189
19740101	189
19740201	167
19740301	211
19740401	317
19740501	333
19740601	350
19740701	350
19740801	333
19740901	311
19741001	250
19741101	272
19741201	133
19750101	172
19750201	144
19750301	178
19750401	233
19750501	339
19750601	339
19750701	339
19750801	367
19750901	272
19751001	283
19751101	256
19751201	161
19760101	133
19760201	211
19760301	222
19760401	356
19760501	283
19760601	333
19760701	322
19760801	344
19760901	317
19761001	228
19761101	161
19761201	128
19770101	67
19770201	144
19770301	272
19770401	322
19770501	333
19770601	311
19770701	400
19770801	339
19770901	344
19771001	211
19771101	183
19771201	133
19780101	144
19780201	50
19780301	183
19780401	278
19780501	322
19780601	328
19780701	350
19780801	333
19780901	300
19781001	244
19781101	211
19781201	194
19790101	172
19790201	139
19790301	244
19790401	272
19790501	344
19790601	306
19790701	350
19790801	350
19790901	322
19791001	311
19791101	228
19791201	183
19800101	156
19800201	139
19800301	150
19800401	244
19800501	322
19800601	344
19800701	389
19800801	361
19800901	356
19801001	261
19801101	217
19801201	178
19810101	94
19810201	200
19810301	250
19810401	272
19810501	306
19810601	339
19810701	356
19810801	333
19810901	317
19811001	217
19811101	222
19811201	144
19820101	144
19820201	144
19820301	156
19820401	278
19820501	289
19820601	306
19820701	367
19820801	317
19820901	311
19821001	272
19821101	261
19821201	222
19830101	144
19830201	150
19830301	200
19830401	294
19830501	261
19830601	350
19830701	367
19830801	356
19830901	372
19831001	289
19831101	206
19831201	150
19840101	139
19840201	172
19840301	144
19840401	256
19840501	294
19840601	356
19840701	328
19840801	333
19840901	300
19841001	261
19841101	206
19841201	211
19850101	144
19850201	239
19850301	278
19850401	311
19850501	306
19850601	294
19850701	333
19850801	350
19850901	344
19851001	267
19851101	250
19851201	128
19860101	172
19860201	89
19860301	256
19860401	278
19860501	344
19860601	328
19860701	367
19860801	317
19860901	317
19861001	289
19861101	228
19861201	150
19870101	139
19870201	111
19870301	244
19870401	250
19870501	361
19870601	356
19870701	350
19870801	344
19870901	294
19871001	222
19871101	250
19871201	156
19880101	117
19880201	167
19880301	244
19880401	228
19880501	328
19880601	367
19880701	372
19880801	372
19880901	289
19881001	261
19881101	194
19881201	156
19890101	161
19890201	194
19890301	278
19890401	250
19890501	300
19890601	333
19890701	356
19890801	344
19890901	344
19891001	250
19891101	211
19891201	117
19900101	189
19900201	183
19900301	294
19900401	328
19900501	283
19900601	317
19900701	350
19900801	339
19900901	317
19901001	289
19901101	256
19901201	189
19910101	128
19910201	211
19910301	250
19910401	322
19910501	339
19910601	361
19910701	389
19910801	344
19910901	339
19911001	267
19911101	233
19911201	189
19920101	167
19920201	178
19920301	178
19920401	272
19920501	339
19920601	306
19920701	339
19920801	328
19920901	300
19921001	256
19921101	217
19921201	161
19930101	178
19930201	133
19930301	200
19930401	261
19930501	333
19930601	350
19930701	389
19930801	356
19930901	350
19931001	256
19931101	267
19931201	167
19940101	128
19940201	167
19940301	217
19940401	289
19940501	328
19940601	367
19940701	361
19940801	328
19940901	311
19941001	239
19941101	244
19941201	183
19950101	178
19950201	122
19950301	222
19950401	244
19950501	306
19950601	350
19950701	389
19950801	356
19950901	328
19951001	300
19951101	222
19951201	128
19960101	133
19960201	167
19960301	172
19960401	294
19960501	356
19960601	311
19960701	317
19960801	322
19960901	317
19961001	244
19961101	206
19961201	172
19970101	167
19970201	222
19970301	200
19970401	233
19970501	283
19970601	339
19970701	361
19970801	339
19970901	283
19971001	294
19971101	183
19971201	122
19980101	183
19980201	144
19980301	300
19980401	228
19980501	306
19980601	333
19980701	339
19980801	328
19980901	322
19981001	233
19981101	172
19981201	239
19990101	156
19990201	167
19990301	233
19990401	267
19990501	317
19990601	344
19990701	383
19990801	367
19990901	283
19991001	239
19991101	222
19991201	172
20000101	178
20000201	178
20000301	206
20000401	239
20000501	339
20000601	333
20000701	317
20000801	322
20000901	289
20001001	261
20001101	194
20001201	167
20010101	122
20010201	161
20010301	139
20010401	306
20010501	333
20010601	328
20010701	344
20010801	394
20010901	300
20011001	272
20011101	239
20011201	217
20020101	206
20020201	172
20020301	222
20020401	356
20020501	300
20020601	333
20020701	356
20020801	367
20020901	328
20021001	289
20021101	200
20021201	156
20030101	100
20030201	100
20030301	206
20030401	311
20030501	261
20030601	339
20030701	344
20030801	328
20030901	267
20031001	250
20031101	261
20031201	144
20040101	144
20040201	150
20040301	211
20040401	294
20040501	306
20040601	328
20040701	306
20040801	322
20040901	306
20041001	239
20041101	200
20041201	150
20050101	189
20050201	133
20050301	172
20050401	306
20050501	261
20050601	339
20050701	361
20050801	372
20050901	333
20051001	267
20051101	222
20051201	128
20060101	178
20060201	167
20060301	233
20060401	283
20060501	311
20060601	328
20060701	350
20060801	361
20060901	283
20061001	261
20061101	206
20061201	211
20070101	222
20070201	94
20070301	256
20070401	300
20070501	328
20070601	328
20070701	333
20070801	333
20070901	311
20071001	306
20071101	189
20071201	161
20080101	178
20080201	200
20080301	172
20080401	289
20080501	283
20080601	356
20080701	356
20080801	322
20080901	322
20081001	239
20081101	194
20081201	194
20090101	83
20090201	183
20090301	211
20090401	333
20090501	300
20090601	289
20090701	300
20090801	333
20090901	289
20091001	233
20091101	206
20091201	189
20100101	139
20100201	78
20100301	233
20100401	333
20100501	333
20100601	339
20100701	394
20100801	356
20100901	356
20101001	239
20101101	183
20101201	156
20110101	117
20110201	194
20110301	250
20110401	283
20110501	317
20110601	350
20110701	400
20110801	344
20110901	300
20111001	289
20111101	211
20111201	167
20120101	167
20120201	167
20120301	256
20120401	311
20120501	317
20120601	344
20120701	378
20120801	328
20120901	328
20121001	256
20121101	189
20121201	167
20130101	161
20130201	128
20130301	150
20130401	278
20130501	322
20130601	333
20130701	367
20130801	322
20130901	356
20131001	300
20131101	211
20131201	217
20140101	144
;
run;
data temphi;
	set temphi;
	yr=1*substr(yrmoday,1,4);
	mo=1*substr(yrmoday,5,2);
	run;
proc sql;
	create table factors
	as select a.*,b.temphi
	from factors a left join temphi b
	on year(a.date)=b.yr and month(a.date)=b.mo;
	quit;
*sun-spots;



data spots; *http://solarscience.msfc.nasa.gov/greenwch/spot.num.txt;
input yr mo nss sd;
   *input yr 4. mo 4. nss 8.1 sd 8.1;
   datalines;
1970  1 111.5  40.3
1970  2 127.8  28.7
1970  3 102.9  29.2
1970  4 109.5  35.6
1970  5 127.5  22.9
1970  6 106.8  33.7
1970  7 112.5  34.3
1970  8  93.0  19.6
1970  9  99.5  21.4
1970 10  86.6  25.3
1970 11  95.2  23.0
1970 12  83.5  17.3
1971  1  91.3  22.2
1971  2  79.0  17.0
1971  3  60.7  14.3
1971  4  71.8  26.7
1971  5  57.5  16.9
1971  6  49.8  27.7
1971  7  81.0  18.7
1971  8  61.4  22.4
1971  9  50.2  20.7
1971 10  51.7  19.4
1971 11  63.2  22.1
1971 12  82.2  19.1
1972  1  61.5  26.9
1972  2  88.4  41.3
1972  3  80.1  25.9
1972  4  63.2  17.1
1972  5  80.5  33.3
1972  6  88.0  19.3
1972  7  76.5  16.5
1972  8  76.8  29.3
1972  9  64.0  21.6
1972 10  61.3  30.8
1972 11  41.6  21.9
1972 12  45.3  17.2
1973  1  43.4  21.5
1973  2  42.9  20.1
1973  3  46.0  19.7
1973  4  57.7  21.1
1973  5  42.4  21.3
1973  6  39.5  18.0
1973  7  23.1  15.4
1973  8  25.6  20.7
1973  9  59.3  36.6
1973 10  30.7  22.8
1973 11  23.9  21.1
1973 12  23.3  20.3
1974  1  27.6  24.2
1974  2  26.0  15.4
1974  3  21.3   9.0
1974  4  40.3  24.1
1974  5  39.5  36.4
1974  6  36.0  19.8
1974  7  55.8  20.8
1974  8  33.6  18.7
1974  9  40.2  26.0
1974 10  47.1  35.4
1974 11  25.0  11.7
1974 12  20.5  14.1
1975  1  18.9  10.1
1975  2  11.5  10.7
1975  3  11.5   9.2
1975  4   5.1   7.5
1975  5   9.0  11.1
1975  6  11.4  11.2
1975  7  28.2   7.9
1975  8  39.7  31.3
1975  9  13.9   9.7
1975 10   9.1   7.4
1975 11  19.4  12.7
1975 12   7.8   8.3
1976  1   8.1  10.0
1976  2   4.3   6.1
1976  3  21.9  16.0
1976  4  18.8   8.4
1976  5  12.4   8.9
1976  6  12.2   9.4
1976  7   1.9   3.7
1976  8  16.4   7.0
1976  9  13.5   7.4
1976 10  20.6   9.6
1976 11   5.2   5.9
1976 12  15.3  10.7
1977  1  16.4  10.8
1977  2  23.1  18.4
1977  3   8.7   6.3
1977  4  12.9   9.2
1977  5  18.6  10.2
1977  6  38.5  18.6
1977  7  21.4  15.6
1977  8  30.1   8.2
1977  9  44.0  14.2
1977 10  43.8   9.2
1977 11  29.1  12.7
1977 12  43.2  16.3
1978  1  51.9  33.3
1978  2  93.6  26.7
1978  3  76.5  16.0
1978  4  99.7  18.3
1978  5  82.7  13.2
1978  6  95.1  41.9
1978  7  70.4  32.7
1978  8  58.1  17.4
1978  9 138.2  29.2
1978 10 125.1  27.3
1978 11  97.9  21.5
1978 12 122.7  35.0
1979  1 166.6  19.3
1979  2 137.5  25.0
1979  3 138.0  15.1
1979  4 101.5  24.7
1979  5 134.4  30.5
1979  6 149.5  43.2
1979  7 159.4  37.2
1979  8 142.2  42.8
1979  9 188.4  36.4
1979 10 186.2  24.8
1979 11 183.3  57.4
1979 12 176.3  57.3
1980  1 159.6  41.0
1980  2 155.0  34.1
1980  3 126.2  51.5
1980  4 164.1  42.3
1980  5 179.9  39.8
1980  6 157.3  25.0
1980  7 136.3  51.6
1980  8 135.4  49.4
1980  9 155.0  43.9
1980 10 164.7  43.4
1980 11 147.9  37.6
1980 12 174.4  32.1
1981  1 114.0  25.3
1981  2 141.3  20.1
1981  3 135.5  20.8
1981  4 156.4  45.2
1981  5 127.5  33.7
1981  6  90.9  31.8
1981  7 143.8  41.1
1981  8 158.7  43.4
1981  9 167.3  27.8
1981 10 162.4  42.7
1981 11 137.5  54.1
1981 12 150.1  72.6
1982  1 111.2  46.6
1982  2 163.6  51.2
1982  3 153.8  19.0
1982  4 122.0  22.6
1982  5  82.2  25.1
1982  6 110.4  35.0
1982  7 106.1  90.2
1982  8 107.6  29.9
1982  9 118.8  24.9
1982 10  94.7  33.9
1982 11  98.1  19.4
1982 12 127.0  37.2
1983  1  84.3  17.2
1983  2  51.0  29.6
1983  3  66.5  23.8
1983  4  80.7  30.5
1983  5  99.2  16.5
1983  6  91.1  22.2
1983  7  82.2  18.6
1983  8  71.8  25.4
1983  9  50.3  15.3
1983 10  55.8  37.4
1983 11  33.4  26.1
1983 12  33.4  21.3
1984  1  57.0  29.1
1984  2  85.4  23.5
1984  3  83.5  20.2
1984  4  69.7  32.4
1984  5  76.4  21.0
1984  6  46.1  14.4
1984  7  37.4  22.2
1984  8  25.5   9.4
1984  9  15.7  18.7
1984 10  12.0   6.9
1984 11  22.8  13.9
1984 12  18.7   6.2
1985  1  16.5  17.4
1985  2  15.9   6.1
1985  3  17.2  11.1
1985  4  16.2  12.1
1985  5  27.5  13.5
1985  6  24.2  17.7
1985  7  30.7  23.0
1985  8  11.1   8.8
1985  9   3.9   4.3
1985 10  18.6  23.0
1985 11  16.2  15.6
1985 12  17.3  18.9
1986  1   2.5   5.0
1986  2  23.2  19.2
1986  3  15.1  11.5
1986  4  18.5  14.5
1986  5  13.7  10.5
1986  6   1.1   2.8
1986  7  18.1  11.0
1986  8   7.4   4.6
1986  9   3.8   4.8
1986 10  35.4  22.0
1986 11  15.2  12.2
1986 12   6.8   8.3
1987  1  10.4   6.6
1987  2   2.4   3.6
1987  3  14.7   6.0
1987  4  39.6  25.4
1987  5  33.0  13.9
1987  6  17.4  14.1
1987  7  33.0  35.0
1987  8  38.7  11.6
1987  9  33.9  14.8
1987 10  60.6  23.0
1987 11  39.9  17.1
1987 12  27.1   9.8
1988  1  59.0  18.8
1988  2  40.0  18.2
1988  3  76.2  23.4
1988  4  88.0  37.7
1988  5  60.1  22.1
1988  6 101.8  30.0
1988  7 113.8  22.9
1988  8 111.6  45.6
1988  9 120.1  34.1
1988 10 125.1  14.0
1988 11 125.1  31.1
1988 12 179.2  40.8
1989  1 161.3  25.3
1989  2 165.1  28.9
1989  3 131.4  31.5
1989  4 130.6  25.0
1989  5 138.5  32.8
1989  6 196.2  40.0
1989  7 126.9  28.5
1989  8 168.9  53.6
1989  9 176.7  66.0
1989 10 159.4  29.3
1989 11 173.0  33.8
1989 12 165.5  47.9
1990  1 177.3  27.9
1990  2 130.5  62.5
1990  3 140.3  47.8
1990  4 140.3  42.2
1990  5 132.2  37.2
1990  6 105.4  39.6
1990  7 149.4  59.6
1990  8 200.3  57.0
1990  9 125.2  21.8
1990 10 145.5  38.1
1990 11 131.4  35.6
1990 12 129.7  32.6
1991  1 136.9  47.9
1991  2 167.5  32.8
1991  3 141.9  36.1
1991  4 140.0  52.5
1991  5 121.3  20.0
1991  6 169.7  34.1
1991  7 173.7  42.0
1991  8 176.3  70.0
1991  9 125.3  20.4
1991 10 144.1  42.8
1991 11 108.2  29.1
1991 12 144.4  31.4
1992  1 150.0  42.6
1992  2 161.1  36.3
1992  3 106.7  21.3
1992  4  99.8  39.7
1992  5  73.8  22.4
1992  6  65.2  14.7
1992  7  85.7  37.3
1992  8  64.5  25.3
1992  9  63.9  14.7
1992 10  88.7  28.1
1992 11  91.8  17.0
1992 12  82.6  22.4
1993  1  59.3  22.3
1993  2  91.0  24.7
1993  3  69.8  16.6
1993  4  62.2  26.5
1993  5  61.3  31.5
1993  6  49.8  30.1
1993  7  57.9  13.7
1993  8  42.2  12.9
1993  9  22.4  13.4
1993 10  56.4  20.4
1993 11  35.6  15.0
1993 12  48.9  22.2
1994  1  57.8  24.7
1994  2  35.5   7.4
1994  3  31.7  15.5
1994  4  16.1  12.1
1994  5  17.8  12.1
1994  6  28.0  20.1
1994  7  35.1  18.9
1994  8  22.5  12.4
1994  9  25.7  19.2
1994 10  44.0  13.5
1994 11  18.0  10.8
1994 12  26.2  13.8
1995  1  24.2  17.3
1995  2  29.9  11.3
1995  3  31.1  17.5
1995  4  14.0  16.2
1995  5  14.5  13.4
1995  6  15.6   8.0
1995  7  14.5   9.4
1995  8  14.3  10.0
1995  9  11.8   9.9
1995 10  21.1  17.7
1995 11   9.0   7.6
1995 12  10.0   6.1
1996  1  11.5  14.4
1996  2   4.4   5.0
1996  3   9.2   7.3
1996  4   4.8   6.0
1996  5   5.5   6.4
1996  6  11.8   7.3
1996  7   8.2   9.1
1996  8  14.4   4.5
1996  9   1.6   3.8
1996 10   0.9   2.8
1996 11  17.9  17.8
1996 12  13.3  12.1
1997  1   5.7   5.2
1997  2   7.6   9.5
1997  3   8.7   7.8
1997  4  15.5   9.8
1997  5  18.5  13.4
1997  6  12.7   5.7
1997  7  10.4  10.9
1997  8  24.4  15.6
1997  9  51.3  24.8
1997 10  22.8   9.1
1997 11  39.0  10.8
1997 12  41.2  12.9
1998  1  31.9  21.0
1998  2  40.3  15.9
1998  3  54.8  13.7
1998  4  53.4  29.9
1998  5  56.3  19.1
1998  6  70.7  18.1
1998  7  66.6  20.0
1998  8  92.2  17.0
1998  9  92.9  24.8
1998 10  55.5  25.5
1998 11  74.0  25.4
1998 12  81.9  24.2
1999  1  62.0  30.0
1999  2  66.3  41.7
1999  3  68.8  24.9
1999  4  63.7  18.0
1999  5 106.4  20.0
1999  6 137.7  33.3
1999  7 113.5  26.0
1999  8  93.7  42.7
1999  9  71.5  24.0
1999 10 116.7  27.9
1999 11 133.2  36.2
1999 12  84.6  18.2
2000  1  90.1  34.7
2000  2 112.9  24.3
2000  3 138.5  25.8
2000  4 125.5  29.4
2000  5 121.6  44.4
2000  6 124.9  25.0
2000  7 170.1  43.3
2000  8 130.5  36.8
2000  9 109.7  39.5
2000 10  99.4  24.9
2000 11 106.8  23.3
2000 12 104.4  28.5
2001  1  95.6  19.3
2001  2  80.6  19.6
2001  3 113.5  62.8
2001  4 107.7  33.9
2001  5  96.6  21.1
2001  6 134.0  36.7
2001  7  81.8  24.9
2001  8 106.4  14.2
2001  9 150.7  27.7
2001 10 125.5  22.8
2001 11 106.5  25.0
2001 12 132.2  19.2
2002  1 114.1  16.9
2002  2 107.4  21.9
2002  3  98.4  13.6
2002  4 120.7  24.6
2002  5 120.8  25.0
2002  6  88.3  29.5
2002  7  99.6  42.0
2002  8 116.4  36.3
2002  9 109.6  18.8
2002 10  97.5  22.1
2002 11  95.5  26.3
2002 12  80.8  35.8
2003  1  79.7  21.8
2003  2  46.0  21.6
2003  3  61.1  25.1
2003  4  60.0  29.1
2003  5  54.6  21.6
2003  6  77.4  22.7
2003  7  83.3  33.4
2003  8  72.7  10.6
2003  9  48.7  16.8
2003 10  65.5  46.1
2003 11  67.3  42.7
2003 12  46.5  22.4
2004  1  37.3  14.8
2004  2  45.8  13.8
2004  3  49.1  16.8
2004  4  39.3  14.8
2004  5  41.5  15.9
2004  6  43.2  19.1
2004  7  51.1  30.1
2004  8  40.9  18.6
2004  9  27.7  13.2
2004 10  48.0  35.3
2004 11  43.5  14.3
2004 12  17.9   7.0
2005  1  31.3  16.5
2005  2  29.2  16.0
2005  3  24.5  13.0
2005  4  24.2   8.2
2005  5  42.7  17.2
2005  6  39.3  21.0
2005  7  40.1  34.1
2005  8  36.4  11.9
2005  9  21.9  11.7
2005 10   8.7   5.2
2005 11  18.0   8.3
2005 12  41.1   9.9
2006  1  15.3   9.6
2006  2   4.9   5.4
2006  3  10.6   8.3
2006  4  30.2  14.6
2006  5  22.3  12.4
2006  6  13.9   9.7
2006  7  12.2   5.6
2006  8  12.9   6.6
2006  9  14.4   9.0
2006 10  10.5   8.7
2006 11  21.4  12.1
2006 12  13.6  10.9
2007  1  16.8   7.3
2007  2  10.7   7.4
2007  3   4.5   4.9
2007  4   3.4   6.2
2007  5  11.7   6.8
2007  6  12.1  13.0
2007  7   9.7   8.2
2007  8   6.0   4.2
2007  9   2.4   4.2
2007 10   0.9   2.8
2007 11   1.7   3.6
2007 12  10.1  10.6
2008  1   3.3   4.3
2008  2   2.1   3.8
2008  3   9.3  13.2
2008  4   2.9   4.4
2008  5   3.2   4.9
2008  6   3.4   3.9
2008  7   0.8   2.5
2008  8   0.5   1.9
2008  9   1.1   2.8
2008 10   2.9   4.3
2008 11   4.1   4.9
2008 12   0.8   2.6
2009  1   1.3   3.1
2009  2   1.4   3.0
2009  3   0.7   2.3
2009  4   0.8   2.3
2009  5   2.9   4.1
2009  6   2.9   4.3
2009  7   3.2   5.4
2009  8   0.0   0.0
2009  9   4.3   6.4
2009 10   4.8   7.6
2009 11   4.1   4.9
2009 12  10.8   9.0
2010  1  13.2   7.3
2010  2  18.8   9.3
2010  3  15.3   7.1
2010  4   8.0   8.4
2010  5   8.7   8.9
2010  6  13.6   7.8
2010  7  16.1   6.7
2010  8  19.6  11.9
2010  9  25.2  11.7
2010 10  23.5  13.7
2010 11  21.5  10.1
2010 12  14.4   8.3
2011  1  18.8   7.7
2011  2  29.6  14.4
2011  3  55.8  25.0
2011  4  54.4  13.1
2011  5  41.5  17.1
2011  6  37.0  21.3
2011  7  43.8  15.9
2011  8  50.6  22.2
2011  9  78.0  21.2
2011 10  88.0  23.4
2011 11  96.7  14.6
2011 12  73.0  17.7
2012  1  58.3  18.6
2012  2  32.9  10.6
2012  3  64.3  16.2
2012  4  55.2  28.6
2012  5  69.0  11.0
2012  6  64.5  33.3
2012  7  66.5  22.8
2012  8  63.0  26.0
2012  9  61.4  22.1
2012 10  53.3  13.8
2012 11  61.8  22.5
2012 12  40.8   9.4
2013  1  62.9  30.0
2013  2  38.1  13.6
2013  3  57.9  20.2
2013  4  72.4  12.8
2013  5  78.7  21.5
2013  6  52.5  23.7
2013  7  57.0  15.9
2013  8  66.0  20.6
2013  9  37.0  15.0
2013 10  85.6  24.1
2013 11  77.6  27.8
2013 12  90.3  17.0
2014  1  82.0  17.3
;
run;
proc sql;
	create table factors
	as select a.*,b.nss
	from factors a left join spots b
	on year(a.date)=b.yr and month(a.date)=b.mo;
	quit;

*Mars position: http://ssd.jpl.nasa.gov/horizons.cgi#results;
data pos;
   input longdate $11. mpos 8.4 mmov 8.4;
   datalines;
1970-Jan-01	1.5786	12.1524
1970-Feb-01	1.7984	12.3294
1970-Mar-01	1.9954	11.9596
1970-Apr-01	2.2009	10.8978
1970-May-01	2.3759	9.2238
1970-Jun-01	2.5209	6.8957
1970-Jul-01	2.6171	4.1544
1970-Aug-01	2.6629	0.9207
1970-Sep-01	2.6483	-2.5871
1970-Oct-01	2.5733	-6.0726
1970-Nov-01	2.4333	-9.5362
1970-Dec-01	2.2420	-12.4710
1971-Jan-01	1.9970	-14.7714
1971-Feb-01	1.7194	-16.0913
1971-Mar-01	1.4559	-16.3716
1971-Apr-01	1.1673	-15.7225
1971-May-01	0.9064	-14.2785
1971-Jun-01	0.6700	-11.9863
1971-Jul-01	0.4893	-8.5805
1971-Aug-01	0.3842	-2.6523
1971-Sep-01	0.4026	4.5326
1971-Oct-01	0.5248	9.1263
1971-Nov-01	0.7150	11.9051
1971-Dec-01	0.9383	13.7377
1972-Jan-01	1.1965	14.9634
1972-Feb-01	1.4699	15.4218
1972-Mar-01	1.7266	15.0799
1972-Apr-01	1.9874	13.9132
1972-May-01	2.2136	12.0826
1972-Jun-01	2.4085	9.5990
1972-Jul-01	2.5506	6.7433
1972-Aug-01	2.6421	3.4534
1972-Sep-01	2.6726	-0.0504
1972-Oct-01	2.6417	-3.4852
1972-Nov-01	2.5485	-6.8638
1972-Dec-01	2.4040	-9.7114
1973-Jan-01	2.2088	-11.9517
1973-Feb-01	1.9815	-13.2784
1973-Mar-01	1.7629	-13.6465
1973-Apr-01	1.5209	-13.2782
1973-May-01	1.2981	-12.4014
1973-Jun-01	1.0860	-11.3059
1973-Jul-01	0.8990	-10.3300
1973-Aug-01	0.7223	-9.4258
1973-Sep-01	0.5648	-7.9598
1973-Oct-01	0.4555	-3.9882
1973-Nov-01	0.4546	4.3681
1973-Dec-01	0.5977	11.5678
1974-Jan-01	0.8437	15.4293
1974-Feb-01	1.1364	16.9824
1974-Mar-01	1.4135	17.0989
1974-Apr-01	1.7126	16.1412
1974-May-01	1.9782	14.3839
1974-Jun-01	2.2148	11.9290
1974-Jul-01	2.3978	9.1148
1974-Aug-01	2.5328	5.9108
1974-Sep-01	2.6088	2.5548
1974-Oct-01	2.6249	-0.6830
1974-Nov-01	2.5841	-3.8157
1974-Dec-01	2.4946	-6.4218
1975-Jan-01	2.3602	-8.4424
1975-Feb-01	2.1969	-9.6323
1975-Mar-01	2.0372	-9.9959
1975-Apr-01	1.8591	-9.7917
1975-May-01	1.6934	-9.3018
1975-Jun-01	1.5309	-8.8780
1975-Jul-01	1.3780	-8.8381
1975-Aug-01	1.2163	-9.2995
1975-Sep-01	1.0429	-10.0908
1975-Oct-01	0.8631	-10.5467
1975-Nov-01	0.6827	-9.0659
1975-Dec-01	0.5718	-2.7051
1976-Jan-01	0.6196	8.0047
1976-Feb-01	0.8322	14.8076
1976-Mar-01	1.1029	17.0545
1976-Apr-01	1.4109	17.0711
1976-May-01	1.6966	15.7573
1976-Jun-01	1.9599	13.5650
1976-Jul-01	2.1728	10.9519
1976-Aug-01	2.3425	7.9675
1976-Sep-01	2.4577	4.8840
1976-Oct-01	2.5171	1.9749
1976-Nov-01	2.5275	-0.7695
1976-Dec-01	2.4944	-2.9844
1977-Jan-01	2.4252	-4.6478
1977-Feb-01	2.3325	-5.6039
1977-Mar-01	2.2387	-5.9386
1977-Apr-01	2.1320	-5.9461
1977-May-01	2.0294	-5.9224
1977-Jun-01	1.9215	-6.1931
1977-Jul-01	1.8083	-6.9574
1977-Aug-01	1.6722	-8.3145
1977-Sep-01	1.5075	-10.1085
1977-Oct-01	1.3164	-11.9067
1977-Nov-01	1.0905	-13.1184
1977-Dec-01	0.8660	-12.2705
1978-Jan-01	0.6884	-6.4542
1978-Feb-01	0.6717	4.9334
1978-Mar-01	0.8221	12.7642
1978-Apr-01	1.0858	15.9233
1978-May-01	1.3646	15.9216
1978-Jun-01	1.6377	14.4249
1978-Jul-01	1.8694	12.2548
1978-Aug-01	2.0658	9.6737
1978-Sep-01	2.2149	7.0117
1978-Oct-01	2.3147	4.5555
1978-Nov-01	2.3756	2.3144
1978-Dec-01	2.3999	0.5806
1979-Jan-01	2.3983	-0.6754
1979-Feb-01	2.3791	-1.4047
1979-Mar-01	2.3535	-1.7415
1979-Apr-01	2.3200	-2.0240
1979-May-01	2.2816	-2.4804
1979-Jun-01	2.2301	-3.3848
1979-Jul-01	2.1601	-4.8013
1979-Aug-01	2.0570	-6.8213
1979-Sep-01	1.9136	-9.2719
1979-Oct-01	1.7310	-11.7961
1979-Nov-01	1.4982	-14.1187
1979-Dec-01	1.2401	-15.4253
1980-Jan-01	0.9668	-14.5510
1980-Feb-01	0.7465	-8.9999
1980-Mar-01	0.6789	1.4555
1980-Apr-01	0.7981	10.8114
1980-May-01	1.0203	14.0414
1980-Jun-01	1.2749	14.0191
1980-Jul-01	1.5071	12.6255
1980-Aug-01	1.7159	10.6493
1980-Sep-01	1.8879	8.5711
1980-Oct-01	2.0199	6.7148
1980-Nov-01	2.1252	5.1314
1980-Dec-01	2.2036	4.0066
1981-Jan-01	2.2678	3.2571
1981-Feb-01	2.3216	2.8005
1981-Mar-01	2.3640	2.4580
1981-Apr-01	2.4034	1.9117
1981-May-01	2.4292	1.0138
1981-Jun-01	2.4352	-0.4389
1981-Jul-01	2.4114	-2.3913
1981-Aug-01	2.3467	-4.9335
1981-Sep-01	2.2326	-7.8714
1981-Oct-01	2.0704	-10.8727
1981-Nov-01	1.8492	-13.8032
1981-Dec-01	1.5896	-16.0372
1982-Jan-01	1.2905	-17.1128
1982-Feb-01	0.9900	-15.9802
1982-Mar-01	0.7615	-11.5737
1982-Apr-01	0.6370	-1.5711
1982-May-01	0.6976	7.7724
1982-Jun-01	0.8788	11.5937
1982-Jul-01	1.0851	11.8843
1982-Aug-01	1.2902	10.8998
1982-Sep-01	1.4740	9.6128
1982-Oct-01	1.6308	8.5103
1982-Nov-01	1.7757	7.7125
1982-Dec-01	1.9054	7.2909
1983-Jan-01	2.0341	7.1001
1983-Feb-01	2.1599	6.9332
1983-Mar-01	2.2695	6.5869
1983-Apr-01	2.3813	5.8145
1983-May-01	2.4718	4.5530
1983-Jun-01	2.5372	2.6790
1983-Jul-01	2.5639	0.3305
1983-Aug-01	2.5443	-2.5740
1983-Sep-01	2.4692	-5.8364
1983-Oct-01	2.3393	-9.1427
1983-Nov-01	2.1456	-12.4377
1983-Dec-01	1.9056	-15.1643
1984-Jan-01	1.6152	-17.1140
1984-Feb-01	1.3008	-17.7770
1984-Mar-01	1.0088	-16.8166
1984-Apr-01	0.7348	-13.2527
1984-May-01	0.5628	-5.9040
1984-Jun-01	0.5449	3.5967
1984-Jul-01	0.6571	8.5295
1984-Aug-01	0.8250	9.8628
1984-Sep-01	1.0027	9.9265
1984-Oct-01	1.1740	9.8748
1984-Nov-01	1.3520	10.0506
1984-Dec-01	1.5293	10.4241
1985-Jan-01	1.7197	10.7964
1985-Feb-01	1.9145	10.8769
1985-Mar-01	2.0883	10.5118
1985-Apr-01	2.2687	9.5082
1985-May-01	2.4207	7.9245
1985-Jun-01	2.5437	5.6994
1985-Jul-01	2.6202	3.0458
1985-Aug-01	2.6471	-0.1129
1985-Sep-01	2.6144	-3.5686
1985-Oct-01	2.5225	-7.0251
1985-Nov-01	2.3654	-10.4642
1985-Dec-01	2.1579	-13.3742
1986-Jan-01	1.8967	-15.6314
1986-Feb-01	1.6039	-16.8728
1986-Mar-01	1.3286	-17.0068
1986-Apr-01	1.0308	-16.0640
1986-May-01	0.7686	-14.0031
1986-Jun-01	0.5485	-10.2352
1986-Jul-01	0.4214	-3.9886
1986-Aug-01	0.4201	3.5694
1986-Sep-01	0.5292	8.0489
1986-Oct-01	0.6891	10.2351
1986-Nov-01	0.8869	11.8256
1986-Dec-01	1.1031	13.0997
1987-Jan-01	1.3465	14.0313
1987-Feb-01	1.6015	14.3506
1987-Mar-01	1.8315	13.9975
1987-Apr-01	2.0729	12.8586
1987-May-01	2.2811	11.0772
1987-Jun-01	2.4585	8.6375
1987-Jul-01	2.5843	5.8128
1987-Aug-01	2.6596	2.5288
1987-Sep-01	2.6738	-0.9906
1987-Oct-01	2.6267	-4.4598
1987-Nov-01	2.5159	-7.8876
1987-Dec-01	2.3534	-10.7953
1988-Jan-01	2.1383	-13.0922
1988-Feb-01	1.8901	-14.4595
1988-Mar-01	1.6435	-14.8425
1988-Apr-01	1.3804	-14.3958
1988-May-01	1.1391	-13.3613
1988-Jun-01	0.9120	-11.9609
1988-Jul-01	0.7174	-10.4572
1988-Aug-01	0.5464	-8.4931
1988-Sep-01	0.4237	-4.7101
1988-Oct-01	0.3990	2.3132
1988-Nov-01	0.5089	9.4716
1988-Dec-01	0.7119	13.5354
1989-Jan-01	0.9765	15.7629
1989-Feb-01	1.2685	16.6558
1989-Mar-01	1.5376	16.4998
1989-Apr-01	1.8246	15.4165
1989-May-01	2.0768	13.6032
1989-Jun-01	2.2987	11.1139
1989-Jul-01	2.4669	8.2611
1989-Aug-01	2.5858	4.9965
1989-Sep-01	2.6445	1.5550
1989-Oct-01	2.6424	-1.7829
1989-Nov-01	2.5810	-5.0381
1989-Dec-01	2.4695	-7.7604
1990-Jan-01	2.3105	-9.8871
1990-Feb-01	2.1210	-11.1413
1990-Mar-01	1.9372	-11.5122
1990-Apr-01	1.7328	-11.2357
1990-May-01	1.5437	-10.5834
1990-Jun-01	1.3608	-9.8893
1990-Jul-01	1.1933	-9.5069
1990-Aug-01	1.0235	-9.5246
1990-Sep-01	0.8510	-9.7115
1990-Oct-01	0.6853	-9.1313
1990-Nov-01	0.5484	-5.2987
1990-Dec-01	0.5283	3.6528
1991-Jan-01	0.6782	12.3159
1991-Feb-01	0.9406	16.3261
1991-Mar-01	1.2158	17.3794
1991-Apr-01	1.5249	16.9057
1991-May-01	1.8060	15.3817
1991-Jun-01	2.0618	13.0754
1991-Jul-01	2.2655	10.3757
1991-Aug-01	2.4240	7.2996
1991-Sep-01	2.5259	4.0971
1991-Oct-01	2.5700	1.0378
1991-Nov-01	2.5617	-1.8899
1991-Dec-01	2.5072	-4.2923
1992-Jan-01	2.4126	-6.1329
1992-Feb-01	2.2920	-7.2086
1992-Mar-01	2.1675	-7.5624
1992-Apr-01	2.0324	-7.4752
1992-May-01	1.9049	-7.2587
1992-Jun-01	1.7756	-7.2646
1992-Jul-01	1.6466	-7.7349
1992-Aug-01	1.4998	-8.7793
1992-Sep-01	1.3302	-10.2367
1992-Oct-01	1.1404	-11.6218
1992-Nov-01	0.9257	-12.0805
1992-Dec-01	0.7315	-9.6012
1993-Jan-01	0.6268	-0.9631
1993-Feb-01	0.7120	9.9570
1993-Mar-01	0.9215	15.1708
1993-Apr-01	1.2115	16.7044
1993-May-01	1.4973	16.0350
1993-Jun-01	1.7694	14.1980
1993-Jul-01	1.9956	11.8255
1993-Aug-01	2.1832	9.0723
1993-Sep-01	2.3203	6.2369
1993-Oct-01	2.4053	3.5919
1993-Nov-01	2.4472	1.1434
1993-Dec-01	2.4495	-0.7926
1994-Jan-01	2.4215	-2.2171
1994-Feb-01	2.3734	-3.0409
1994-Mar-01	2.3209	-3.3817
1994-Apr-01	2.2586	-3.5548
1994-May-01	2.1948	-3.8249
1994-Jun-01	2.1209	-4.4906
1994-Jul-01	2.0336	-5.6650
1994-Aug-01	1.9169	-7.4480
1994-Sep-01	1.7641	-9.6730
1994-Oct-01	1.5767	-11.9581
1994-Nov-01	1.3438	-13.9463
1994-Dec-01	1.0937	-14.6462
1995-Jan-01	0.8457	-12.3396
1995-Feb-01	0.6884	-4.1012
1995-Mar-01	0.7092	6.4982
1995-Apr-01	0.8974	13.4207
1995-May-01	1.1493	15.1114
1995-Jun-01	1.4157	14.3922
1995-Jul-01	1.6507	12.6461
1995-Aug-01	1.8573	10.3981
1995-Sep-01	2.0226	8.0610
1995-Oct-01	2.1437	5.9456
1995-Nov-01	2.2330	4.0798
1995-Dec-01	2.2913	2.6965
1996-Jan-01	2.3304	1.7341
1996-Feb-01	2.3561	1.1637
1996-Mar-01	2.3726	0.8045
1996-Apr-01	2.3834	0.3584
1996-May-01	2.3839	-0.3772
1996-Jun-01	2.3668	-1.6249
1996-Jul-01	2.3242	-3.3815
1996-Aug-01	2.2432	-5.7308
1996-Sep-01	2.1162	-8.4944
1996-Oct-01	1.9442	-11.3302
1996-Nov-01	1.7161	-14.0596
1996-Dec-01	1.4542	-15.9998
1997-Jan-01	1.1601	-16.4988
1997-Feb-01	0.8808	-14.0399
1997-Mar-01	0.7017	-7.2747
1997-Apr-01	0.6729	4.0654
1997-May-01	0.8130	11.0332
1997-Jun-01	1.0331	12.9260
1997-Jul-01	1.2542	12.3819
1997-Aug-01	1.4635	10.9374
1997-Sep-01	1.6444	9.3000
1997-Oct-01	1.7926	7.8741
1997-Nov-01	1.9228	6.7435
1997-Dec-01	2.0328	6.0315
1998-Jan-01	2.1366	5.6102
1998-Feb-01	2.2345	5.3234
1998-Mar-01	2.3182	4.9844
1998-Apr-01	2.4020	4.2909
1998-May-01	2.4674	3.1615
1998-Jun-01	2.5096	1.4385
1998-Jul-01	2.5163	-0.7682
1998-Aug-01	2.4786	-3.5427
1998-Sep-01	2.3876	-6.6875
1998-Oct-01	2.2441	-9.8861
1998-Nov-01	2.0383	-13.0519
1998-Dec-01	1.7889	-15.6196
1999-Jan-01	1.4922	-17.3079
1999-Feb-01	1.1778	-17.4828
1999-Mar-01	0.9065	-15.6487
1999-Apr-01	0.6701	-9.9375
1999-May-01	0.5785	-0.2417
1999-Jun-01	0.6542	7.7272
1999-Jul-01	0.8165	10.3414
1999-Aug-01	1.0052	10.4927
1999-Sep-01	1.1884	9.9230
1999-Oct-01	1.3556	9.4080
1999-Nov-01	1.5214	9.1764
1999-Dec-01	1.6805	9.2279
2000-Jan-01	1.8470	9.3863
2000-Feb-01	2.0153	9.3853
2000-Mar-01	2.1699	9.0241
2000-Apr-01	2.3239	8.1043
2000-May-01	2.4523	6.6327
2000-Jun-01	2.5528	4.5201
2000-Jul-01	2.6096	1.9604
2000-Aug-01	2.6176	-1.1311
2000-Sep-01	2.5673	-4.5398
2000-Oct-01	2.4592	-7.9591
2000-Nov-01	2.2860	-11.3615
2000-Dec-01	2.0637	-14.2188
2001-Jan-01	1.7885	-16.3816
2001-Feb-01	1.4840	-17.4527
2001-Mar-01	1.2013	-17.3246
2001-Apr-01	0.9026	-15.7784
2001-May-01	0.6550	-12.4121
2001-Jun-01	0.4859	-5.8558
2001-Jul-01	0.4564	2.3289
2001-Aug-01	0.5504	7.4286
2001-Sep-01	0.7035	9.3664
2001-Oct-01	0.8748	10.3375
2001-Nov-01	1.0683	11.2543
2001-Dec-01	1.2713	12.1418
2002-Jan-01	1.4957	12.8496
2002-Feb-01	1.7288	13.0782
2002-Mar-01	1.9382	12.7086
2002-Apr-01	2.1571	11.6206
2002-May-01	2.3445	9.9086
2002-Jun-01	2.5014	7.5456
2002-Jul-01	2.6087	4.7765
2002-Aug-01	2.6654	1.5284
2002-Sep-01	2.6615	-1.9843
2002-Oct-01	2.5967	-5.4703
2002-Nov-01	2.4672	-8.9347
2002-Dec-01	2.2861	-11.8770
2003-Jan-01	2.0514	-14.2012
2003-Feb-01	1.7835	-15.5652
2003-Mar-01	1.5281	-15.8995
2003-Apr-01	1.2471	-15.3658
2003-May-01	0.9909	-14.1229
2003-Jun-01	0.7541	-12.2684
2003-Jul-01	0.5615	-9.8274
2003-Aug-01	0.4188	-5.7241
2003-Sep-01	0.3742	1.1373
2003-Oct-01	0.4526	7.5332
2003-Nov-01	0.6264	11.5289
2003-Dec-01	0.8480	13.8854
2004-Jan-01	1.1112	15.3632
2004-Feb-01	1.3929	15.9397
2004-Mar-01	1.6587	15.6500
2004-Apr-01	1.9299	14.4941
2004-May-01	2.1663	12.6577
2004-Jun-01	2.3716	10.1615
2004-Jul-01	2.5236	7.3014
2004-Aug-01	2.6254	4.0199
2004-Sep-01	2.6664	0.5403
2004-Oct-01	2.6461	-2.8614
2004-Nov-01	2.5645	-6.1964
2004-Dec-01	2.4318	-9.0059
2005-Jan-01	2.2494	-11.2137
2005-Feb-01	2.0353	-12.5263
2005-Mar-01	1.8285	-12.9060
2005-Apr-01	1.5992	-12.5786
2005-May-01	1.3876	-11.7858
2005-Jun-01	1.1851	-10.8402
2005-Jul-01	1.0042	-10.0909
2005-Aug-01	0.8286	-9.5743
2005-Sep-01	0.6626	-8.8758
2005-Oct-01	0.5253	-6.4907
2005-Nov-01	0.4644	0.5646
2005-Dec-01	0.5533	9.3707
2006-Jan-01	0.7752	14.7500
2006-Feb-01	1.0623	16.9508
2006-Mar-01	1.3409	17.3203
2006-Apr-01	1.6451	16.5012
2006-May-01	1.9174	14.8114
2006-Jun-01	2.1618	12.3950
2006-Jul-01	2.3530	9.6103
2006-Aug-01	2.4970	6.4367
2006-Sep-01	2.5829	3.1209
2006-Oct-01	2.6094	-0.0638
2006-Nov-01	2.5805	-3.1333
2006-Dec-01	2.5035	-5.6734
2007-Jan-01	2.3834	-7.6326
2007-Feb-01	2.2352	-8.7809
2007-Mar-01	2.0894	-9.1449
2007-Apr-01	1.9265	-8.9807
2007-May-01	1.7742	-8.5845
2007-Jun-01	1.6233	-8.3036
2007-Jul-01	1.4788	-8.4398
2007-Aug-01	1.3223	-9.1080
2007-Sep-01	1.1499	-10.1576
2007-Oct-01	0.9656	-11.0147
2007-Nov-01	0.7696	-10.4411
2007-Dec-01	0.6209	-5.7630
2008-Jan-01	0.6073	4.7638
2008-Feb-01	0.7782	13.3544
2008-Mar-01	1.0341	16.5769
2008-Apr-01	1.3382	17.0433
2008-May-01	1.6254	15.9310
2008-Jun-01	1.8930	13.8601
2008-Jul-01	2.1116	11.3289
2008-Aug-01	2.2885	8.4212
2008-Sep-01	2.4123	5.4147
2008-Oct-01	2.4813	2.5875
2008-Nov-01	2.5033	-0.0688
2008-Dec-01	2.4830	-2.1981
2009-Jan-01	2.4286	-3.7909
2009-Feb-01	2.3517	-4.7086
2009-Mar-01	2.2725	-5.0418
2009-Apr-01	2.1816	-5.1088
2009-May-01	2.0929	-5.1880
2009-Jun-01	1.9971	-5.5996
2009-Jul-01	1.8931	-6.5128
2009-Aug-01	1.7639	-8.0243
2009-Sep-01	1.6032	-9.9759
2009-Oct-01	1.4128	-11.9622
2009-Nov-01	1.1834	-13.4897
2009-Dec-01	0.9474	-13.3132
2010-Jan-01	0.7388	-8.9704
2010-Feb-01	0.6660	1.6439
2010-Mar-01	0.7733	10.8540
2010-Apr-01	1.0150	15.2156
2010-May-01	1.2866	15.7196
2010-Jun-01	1.5588	14.4659
2010-Jul-01	1.7927	12.4371
2010-Aug-01	1.9937	9.9757
2010-Sep-01	2.1494	7.4326
2010-Oct-01	2.2575	5.0954
2010-Nov-01	2.3290	2.9844
2010-Dec-01	2.3658	1.3661
2011-Jan-01	2.3789	0.2045
2011-Feb-01	2.3757	-0.4784
2011-Mar-01	2.3649	-0.8216
2011-Apr-01	2.3472	-1.1634
2011-May-01	2.3227	-1.7147
2011-Jun-01	2.2837	-2.7387
2011-Jul-01	2.2238	-4.2728
2011-Aug-01	2.1291	-6.4136
2011-Sep-01	1.9919	-8.9829
2011-Oct-01	1.8136	-11.6297
2011-Nov-01	1.5824	-14.1218
2011-Dec-01	1.3224	-15.7065
2012-Jan-01	1.0395	-15.4476
2012-Feb-01	0.7925	-11.2379
2012-Mar-01	0.6762	-1.8296
2012-Apr-01	0.7449	8.7476
2012-May-01	0.9428	13.1952
2012-Jun-01	1.1879	13.7309
2012-Jul-01	1.4175	12.5921
2012-Aug-01	1.6274	10.7816
2012-Sep-01	1.8033	8.8502
2012-Oct-01	1.9416	7.1425
2012-Nov-01	2.0562	5.7193
2012-Dec-01	2.1463	4.7396
2013-Jan-01	2.2250	4.1088
2013-Feb-01	2.2948	3.7154
2013-Mar-01	2.3520	3.3665
2013-Apr-01	2.4073	2.7710
2013-May-01	2.4473	1.7907
2013-Jun-01	2.4662	0.2439
2013-Jul-01	2.4533	-1.7988
2013-Aug-01	2.3982	-4.4245
2013-Sep-01	2.2923	-7.4414
2013-Oct-01	2.1367	-10.5214
2013-Nov-01	1.9207	-13.5554
2013-Dec-01	1.6642	-15.9356
2014-Jan-01	1.3649	-17.2839
2014-Feb-01	1.0570	-16.7291
2014-Mar-01	0.8086	-13.4347
;
run;
data pos2;
	set pos;
	yr=1*substr(longdate,1,4);
	mo=month(input(substr(longdate,6,3)||substr(longdate,1,4),monyy7.));
	run;
proc sql;
	create table factors
	as select a.*,b.mpos,b.mmov
	from factors a left join pos2 b
	on year(a.date)=b.yr and month(a.date)=b.mo;
	quit;
data factors;
	set factors;
	if date<='01JAN1984'd then dy_mkt=.; *during 1983 spotty;
	run;

*proc contents data=factors;
*	run;

data factors;
	set factors;
	where '01NOV1975'd<=date<='31DEC2012'd;
	run;


*create changes;
*create changes for those that it makes sense;

* agr_mkt avglag avglagsq bm_mkt bond cgdp cons cpiret crspread csent
demo dy_mkt ep_mkt hml jan mktrf mmov mpos nss PS_INNOV PS_LEVEL reit 
rf sent sent2 sgr_mkt smb temphi
term umd vix;
proc sort data=factors;
	by date;
	run;
data factors2;
	set factors;
	by date;
	array one{*} agr_mkt avglag avglagsq bm_mkt cgdp cons crspread csent dy_mkt ep_mkt nss rf sent sent2 sgr_mkt temphi term vix;
	array two{*} ch_agr_mkt ch_avglag ch_avglagsq ch_bm_mkt ch_cgdp ch_cons ch_crspread ch_csent ch_dy_mkt 
				ch_ep_mkt ch_nss ch_rf ch_sent ch_sent2 ch_sgr_mkt ch_temphi ch_term ch_vix;
	do i=1 to dim(one);
		two(i)=one(i)-lag(one(i));
	end;
	run;
* agr_mkt avglag avglagsq bm_mkt bond cgdp cons cpiret crspread csent
demo dy_mkt ep_mkt hml jan mktrf mmov mpos nss PS_INNOV PS_LEVEL reit 
rf sent sent2 sgr_mkt smb temphi term umd vix
ch_agr_mkt ch_avglag ch_avglagsq ch_bm_mkt ch_cgdp ch_cons ch_crspread ch_csent ch_dy_mkt 
ch_ep_mkt ch_nss ch_rf ch_sent ch_sent2 ch_sgr_mkt ch_temphi ch_term ch_vix
	;   *create lags (including of changes);
proc sort data=factors2;
	by date;
	run;
data factors2;
	set factors2;
	by date;
	array one{*} agr_mkt avglag avglagsq bm_mkt bond cgdp cons cpiret crspread csent
 dy_mkt ep_mkt hml  mktrf mmov mpos nss PS_INNOV PS_LEVEL reit 
rf sent sent2 sgr_mkt smb temphi term umd vix
ch_agr_mkt ch_avglag ch_avglagsq ch_bm_mkt ch_cgdp ch_cons ch_crspread ch_csent ch_dy_mkt 
				ch_ep_mkt ch_nss ch_rf ch_sent ch_sent2 ch_sgr_mkt ch_temphi ch_term ch_vix;
	array two{*} agr_mkt_l1 avglag_l1 avglagsq_l1 bm_mkt_l1 bond_l1 cgdp_l1 cons_l1 cpiret_l1 crspread_l1 csent_l1
 dy_mkt_l1 ep_mkt_l1 hml_l1  mktrf_l1 mmov_l1 mpos_l1 nss_l1 PS_INNOV_l1 PS_LEVEL_l1 reit_l1 
rf_l1 sent_l1 sent2_l1 sgr_mkt_l1 smb_l1 temphi_l1
term_l1 umd_l1 vix_l1 ch_agr_mkt_l1 ch_avglag_l1 ch_avglagsq_l1 ch_bm_mkt_l1 ch_cgdp_l1 ch_cons_l1 ch_crspread_l1 ch_csent_l1 ch_dy_mkt_l1 
				ch_ep_mkt_l1 ch_nss_l1 ch_rf_l1 ch_sent_l1 ch_sent2_l1 ch_sgr_mkt_l1 ch_temphi_l1 ch_term_l1 ch_vix_l1;
	do i=1 to dim(one);
		two(i)=lag(one(i));
	end;
	run;
*agr_mkt avglag avglagsq bm_mkt bond cgdp cons cpiret crspread csent
demo dy_mkt ep_mkt hml jan mktrf mmov mpos nss PS_INNOV PS_LEVEL reit 
rf sent sent2 sgr_mkt smb temphi term umd vix
ch_agr_mkt ch_avglag ch_avglagsq ch_bm_mkt ch_cgdp ch_cons ch_crspread ch_csent ch_dy_mkt 
ch_ep_mkt ch_nss ch_rf ch_sent ch_sent2 ch_sgr_mkt ch_temphi ch_term ch_vix
agr_mkt_l1 avglag_l1 avglagsq_l1 bm_mkt_l1 bond_l1 cgdp_l1 cons_l1 cpiret_l1 crspread_l1 csent_l1
 dy_mkt_l1 ep_mkt_l1 hml_l1  mktrf_l1 mmov_l1 mpos_l1 nss_l1 PS_INNOV_l1 PS_LEVEL_l1 reit_l1 
rf_l1 sent_l1 sent2_l1 sgr_mkt_l1 smb_l1 temphi_l1
term_l1 umd_l1 vix_l1 ch_agr_mkt_l1 ch_avglag_l1 ch_avglagsq_l1 ch_bm_mkt_l1 ch_cgdp_l1 ch_cons_l1 ch_crspread_l1 ch_csent_l1 ch_dy_mkt_l1 
				ch_ep_mkt_l1 ch_nss_l1 ch_rf_l1 ch_sent_l1 ch_sent2_l1 ch_sgr_mkt_l1 ch_temphi_l1 ch_term_l1 ch_vix_l1;

*any other fixes?;
	*when matching up with firm level data and returns, would it be good to recalculate demo and jan?,
		add everything else measured as the date when then RPS are measured, but the jan and demo could be contemporaneous, or at least JAN could or should be;

data factors;
	set factors2;
	where '01DEC1979'd<=date<='31DEC2012'd;
	run;
